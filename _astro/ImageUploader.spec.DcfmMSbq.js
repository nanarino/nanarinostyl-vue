import{v as U}from"./runtime-dom.esm-bundler.Ci8mymij.js";import{_ as k}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as I,c as g,o as p,w as D,F as L,r as V,a as i,m as R,u as x,b as j,e as B,n as b,t as w,f as F,g as S,s as O,h as P,i as z}from"./runtime-core.esm-bundler.Dv-2Nucp.js";import{m as T}from"./message.CURnrVnq.js";const f=Symbol("revoked");async function A(r){if(r instanceof Blob){const t=URL.createObjectURL(r);return Reflect.set(r,"url",t),Reflect.set(r,f,!1),r}else return r}function K(r){f in r&&r[f]===!1&&(URL.revokeObjectURL(r.url),r[f]=!0)}const M=I({__name:"index",props:R({accept:{default:()=>["image/*"]},limit:{default:1/0},customCreateUrl:{type:Function,default:A},customRevokeUrl:{type:Function,default:K}},{modelValue:{default:()=>[]},modelModifiers:{}}),emits:R(["change","loadError","overLimit"],["update:modelValue"]),setup(r,{expose:t,emit:m}){const e=x(r,"modelValue"),s=r,l=m;function o(a){a.stopPropagation(),a.preventDefault()}async function d(a){if(a.stopPropagation(),a.preventDefault(),e.value.length+(a.dataTransfer?.files?.length||0)>s.limit)return l("overLimit");await c(a.dataTransfer?.files||[])}const u=async a=>Promise.all(Array.from(a).filter(n=>s.accept.filter(v=>new RegExp(v).test(n.type)).length).map(async n=>"url"in n?f in n&&n[f]?s.customCreateUrl(n):n:s.customCreateUrl(n))),c=async a=>{const n=await u(a);e.value=[...e.value,...n],await b(),l("change",{images:n,action:"append"})};async function C(a){const n=a.target?.files||[];e.value.length+n.length<=s.limit?await c(n):l("overLimit"),a.target.value=""}async function E(a,n,v){l("loadError",a,n,v)}const _=async a=>{const n=e.value.splice(a,1);e.value=[...e.value],await s.customRevokeUrl(n[0]),await b(),l("change",{images:n,action:"remove"})},y=j(()=>e.value.reduce((a,n)=>a+n.size,0));t({append:c,remove:_,size:y,files_setup_effect:u}),async function(){await u(e.value)}(),B(async()=>{await Promise.all(e.value.map(s.customRevokeUrl))});const h={images:e,props:s,emit:l,handleDrag:o,handleDrop:d,files_setup_effect:u,append:c,handleInput:C,handleLoadError:E,remove:_,size:y};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),N={class:"na-image-uploader"},q=["src","onError"],G={class:"na-image-footer"},H={class:"na-image-footer-content"},J={class:"na-paragraph","data-ellipsis":"2"},Q={class:"na-image-footer-action"},W=["onClick"],X=["accept"];function Y(r,t,m,e,s,l){return p(),g("div",N,[(p(!0),g(L,null,V(m.modelValue,(o,d)=>D((p(),g("div",{class:"na-image",key:o.url},[i("img",{src:o.url,onDragstart:e.handleDrag,onError:u=>e.handleLoadError(u,o,d)},null,40,q),i("div",G,[i("div",H,[i("div",J,w(o.name),1)]),i("div",Q,[i("iconify-icon",{icon:"line-md:remove",name:"delete",class:"na-link",onClick:u=>e.remove(d)},null,8,W)])])])),[[U,e.images.length>0]])),128)),D(i("div",{class:"na-image na-input-wrapper",onDrop:t[0]||(t[0]=o=>e.images.length<e.props.limit?e.handleDrop(o):e.handleDrag(o)),onDragenter:e.handleDrag,onDragover:e.handleDrag,"data-primary":""},[i("input",{type:"file",class:"na-input",accept:`${m.accept||"image/*"}`||"image/*",onChange:e.handleInput,multiple:""},null,40,X),t[1]||(t[1]=i("iconify-icon",{icon:"line-md:plus",style:{"font-size":"48px","pointer-events":"none"}},null,-1)),t[2]||(t[2]=i("span",null," 點擊添加或拖拽相片 ",-1))],544),[[U,e.images.length<e.props.limit]])])}const Z=k(M,[["render",Y],["__scopeId","data-v-53e8e30a"]]),$=I({__name:"ImageUploader.spec",setup(r,{expose:t}){t();const m=O([]),e=P("ImageUploaderRef"),s=async d=>{console.log(d),console.log(e.value?.size)};(async function(){const c=await(await fetch("/na-vue/data/Kirby.json")).json();c.url&&(c.url=c.url.replace(/^\//,"/na-vue/")),m.value=[c]})();const l=z(!0),o={imgs:m,ImageUploaderRef:e,change:s,v_if:l,get ImageUploader(){return Z},get message(){return T}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),ee={style:{display:"contents"}},ae={class:"na-font-mono"};function ne(r,t,m,e,s,l){return p(),g("view",ee,[i("button",{class:"na-button",onClick:t[0]||(t[0]=o=>e.v_if=!e.v_if)},"測試v-if"),e.v_if?(p(),F(e.ImageUploader,{key:0,modelValue:e.imgs,"onUpdate:modelValue":t[1]||(t[1]=o=>e.imgs=o),limit:9,accept:["image/gif","image/jpeg","image/png"],ref:"ImageUploaderRef",onChange:e.change,onOverLimit:t[2]||(t[2]=o=>e.message({content:"超出数量限制",primary:"danger"}))},null,8,["modelValue"])):S("",!0),i("p",ae,w(e.imgs.map(o=>o.name)),1)])}const ie=k($,[["render",ne],["__scopeId","data-v-bbe7bf9c"]]);export{ie as default};
